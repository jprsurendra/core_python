from rapidfuzz import process, fuzz


# Fetch carrier_name + SCAC code once from DB
carriers=  [{'carrier_name': 'American Airlines', 'carrier_scac_code': 'AA'}, {'carrier_name': 'CargoItalia (alternate)', 'carrier_scac_code': '2G'}, {'carrier_name': 'Continental Airlines', 'carrier_scac_code': 'CO'}, {'carrier_name': 'Delta Air Lines', 'carrier_scac_code': 'DL'}, {'carrier_name': 'Northwest Airlines (alternate site)', 'carrier_scac_code': 'NW'}, {'carrier_name': 'Air Canada', 'carrier_scac_code': 'AC'}, {'carrier_name': 'United Airlines Cargo', 'carrier_scac_code': 'UA'}, {'carrier_name': 'Canadian Airlines Int´l', 'carrier_scac_code': 'CP'}, {'carrier_name': 'Lufthansa Cargo AG', 'carrier_scac_code': 'LH'}, {'carrier_name': 'Fedex', 'carrier_scac_code': 'FX'}, {'carrier_name': 'Alaska Airlines', 'carrier_scac_code': 'AS'}, {'carrier_name': 'USAirways', 'carrier_scac_code': 'US'}, {'carrier_name': 'VARIG Brazilian Airlines', 'carrier_scac_code': 'RG'}, {'carrier_name': 'Dragonair', 'carrier_scac_code': 'KA'}, {'carrier_name': 'LAN Chile', 'carrier_scac_code': 'LA'}, {'carrier_name': 'TAP Air Portugal', 'carrier_scac_code': 'TP'}, {'carrier_name': 'Cyprus Airways', 'carrier_scac_code': 'CY'}, {'carrier_name': 'Olympic Airways', 'carrier_scac_code': 'OA'}, {'carrier_name': 'Aer Lingus Cargo', 'carrier_scac_code': 'EI'}, {'carrier_name': 'Alitalia', 'carrier_scac_code': 'AZ'}, {'carrier_name': 'Air France', 'carrier_scac_code': 'AF'}, {'carrier_name': 'Indian Airlines', 'carrier_scac_code': 'IC'}, {'carrier_name': 'Air Seychelles', 'carrier_scac_code': 'HM'}, {'carrier_name': 'Czech Airlines', 'carrier_scac_code': 'OK'}, {'carrier_name': 'Saudi Arabian Airlines', 'carrier_scac_code': 'SV'}, {'carrier_name': 'Syrian Arab Airlines', 'carrier_scac_code': 'RB'},
            {'carrier_name': 'Ethiopian Airlines', 'carrier_scac_code': 'ET'}, {'carrier_name': 'Gulf Air', 'carrier_scac_code': 'GF'}, {'carrier_name': 'KLM Cargo', 'carrier_scac_code': 'KL'}, {'carrier_name': 'Iberia', 'carrier_scac_code': 'IB'}, {'carrier_name': 'Middle East Airlines', 'carrier_scac_code': 'ME'}, {'carrier_name': 'Egyptair', 'carrier_scac_code': 'MS'}, {'carrier_name': 'Philippine Airlines', 'carrier_scac_code': 'PR'}, {'carrier_name': 'Air France', 'carrier_scac_code': 'AF'}, {'carrier_name': 'LOT Polish Airlines', 'carrier_scac_code': 'LO'}, {'carrier_name': 'Qantas Airways', 'carrier_scac_code': 'QF'}, {'carrier_name': 'Brussels Airlines', 'carrier_scac_code': 'SN'}, {'carrier_name': 'South African Airways', 'carrier_scac_code': 'SA'}, {'carrier_name': 'Air New Zealand', 'carrier_scac_code': 'NZ'}, {'carrier_name': 'Kingfisher Airlines', 'carrier_scac_code': 'IT'}, {'carrier_name': 'KD Avia', 'carrier_scac_code': 'KD'}, {'carrier_name': 'Iran Air', 'carrier_scac_code': 'IR'}, {'carrier_name': 'Air India', 'carrier_scac_code': 'AI'}, {'carrier_name': 'Finnair', 'carrier_scac_code': 'AY'}, {'carrier_name': 'Caribbean Airlines', 'carrier_scac_code': 'BW'}, {'carrier_name': 'Icelandair', 'carrier_scac_code': 'FI'}, {'carrier_name': 'China Cargo Airlines', 'carrier_scac_code': 'CK'}, {'carrier_name': 'EL AL', 'carrier_scac_code': 'LY'}, {'carrier_name': 'JAT Airways', 'carrier_scac_code': 'JU'}, {'carrier_name': 'SAS-Scandinavian Airlines System', 'carrier_scac_code': 'SK'}, {'carrier_name': 'TAAG Angola Airlines', 'carrier_scac_code': 'DT'}, {'carrier_name': 'Air ALM', 'carrier_scac_code': 'LM'}, {'carrier_name': 'Air Algerie', 'carrier_scac_code': 'AH'}, {'carrier_name': 'British Airways', 'carrier_scac_code': 'BA'}, {'carrier_name': 'Garuda Indonesia', 'carrier_scac_code': 'GA'}, {'carrier_name': 'Martinair Cargo', 'carrier_scac_code': 'MP'}, {'carrier_name': 'Japan Airlines', 'carrier_scac_code': 'JL'}, {'carrier_name': 'LACSA Airlines of Costa Rica', 'carrier_scac_code': 'LR'}, {'carrier_name': 'Aeromexico Cargo', 'carrier_scac_code': 'AM'}, {'carrier_name': 'LIAT Airlines', 'carrier_scac_code': 'LI'}, {'carrier_name': 'Royal Air Maroc', 'carrier_scac_code': 'AT'}, {'carrier_name': 'Libyan Airlines', 'carrier_scac_code': 'LN'}, {'carrier_name': 'Qatar Airways', 'carrier_scac_code': 'QR'}, {'carrier_name': 'Cathay Pacific Airways', 'carrier_scac_code': 'CX'}, {'carrier_name': 'TNT Airways', 'carrier_scac_code': '3V'}, {'carrier_name': 'Adria Airways', 'carrier_scac_code': 'JP'}, {'carrier_name': 'Cargolux Airlines', 'carrier_scac_code': 'CV'}, {'carrier_name': 'Emirates', 'carrier_scac_code': 'EK'}, {'carrier_name': 'Korean Air', 'carrier_scac_code': 'KE'}, {'carrier_name': 'Malev Hungarian Airlines', 'carrier_scac_code': 'MA'}, {'carrier_name': 'VARIG Brazilian Airlines', 'carrier_scac_code': 'RG'}, {'carrier_name': 'Jade Cargo International', 'carrier_scac_code': 'JI'}, {'carrier_name': 'Air Jamaica', 'carrier_scac_code': 'JM'}, {'carrier_name': 'TACA', 'carrier_scac_code': 'TA'}, {'carrier_name': 'ANA All Nippon Cargo', 'carrier_scac_code': 'NH'}, {'carrier_name': 'Pakistan Int´l Airlines', 'carrier_scac_code': 'PK'}, {'carrier_name': 'Thai Airways', 'carrier_scac_code': 'TG'}, {'carrier_name': 'Kuwait Airways', 'carrier_scac_code': 'KU'}, {'carrier_name': 'Copa Airlines Cargo', 'carrier_scac_code': 'CM'}, {'carrier_name': 'Lauda Air', 'carrier_scac_code': 'NG'}, {'carrier_name': 'Malaysian Airline System', 'carrier_scac_code': 'MH'}, {'carrier_name': 'Homepage', 'carrier_scac_code': 'MH'}, {'carrier_name': 'Japan Air System', 'carrier_scac_code': 'JD'}, {'carrier_name': 'Turkish Airlines', 'carrier_scac_code': 'TK'}, {'carrier_name': 'British Midland Airways', 'carrier_scac_code': 'BD'}, {'carrier_name': 'Air Mauritius', 'carrier_scac_code': 'MK'}, {'carrier_name': 'Austrian Cargo', 'carrier_scac_code': 'OS'}, {'carrier_name': 'Air Madagascar', 'carrier_scac_code': 'MD'}, {'carrier_name': 'Far Eastern Air Transport', 'carrier_scac_code': 'EF'}, {'carrier_name': 'LTU (Leisure Cargo)', 'carrier_scac_code': 'LT'}, {'carrier_name': 'Trans Mediterranean Airways', 'carrier_scac_code': 'TL'}, {'carrier_name': 'Kalitta Air', 'carrier_scac_code': 'K4'}, {'carrier_name': 'Air Hong Kong', 'carrier_scac_code': 'LD'}, {'carrier_name': 'China Airlines', 'carrier_scac_code': 'CI'}, {'carrier_name': 'Global Aviation and Services', 'carrier_scac_code': '5S'}, {'carrier_name': 'Sky West Airlines', 'carrier_scac_code': 'OO'}, {'carrier_name': 'Centurion Air Cargo', 'carrier_scac_code': 'WE'}, {'carrier_name': 'Shandong Airlines (Chinese)', 'carrier_scac_code': 'SC'}, {'carrier_name': 'Florida West International Airways', 'carrier_scac_code': 'RF'}, {'carrier_name': 'Northern Air Cargo', 'carrier_scac_code': 'NC'}, {'carrier_name': 'Cargolux Italia', 'carrier_scac_code': 'C8'}, {'carrier_name': 'Atlas Air', 'carrier_scac_code': '5Y'}, {'carrier_name': 'Cayman Airways', 'carrier_scac_code': 'KX'}, {'carrier_name': 'Aegean Airlines', 'carrier_scac_code': 'A3'}, {'carrier_name': 'Polar Air Cargo', 'carrier_scac_code': 'PO'}, {'carrier_name': 'Arrow Air', 'carrier_scac_code': 'JW'}, {'carrier_name': 'UPS Air Cargo', 'carrier_scac_code': '5X'}, {'carrier_name': 'National Air Cargo', 'carrier_scac_code': 'N8'}, {'carrier_name': 'Siberia Airlines', 'carrier_scac_code': 'S7'}, {'carrier_name': 'DHL Aviation/DHL Airways', 'carrier_scac_code': 'ER'}, {'carrier_name': 'Air Astana', 'carrier_scac_code': 'KC'}, {'carrier_name': 'Shenzhen Airlines (Chinese)', 'carrier_scac_code': 'ZH'}, {'carrier_name': 'Aeroflot', 'carrier_scac_code': 'SU'}, {'carrier_name': 'Royal Jordanian', 'carrier_scac_code': 'RJ'}, {'carrier_name': 'Southwest Airlines', 'carrier_scac_code': 'WN'}, {'carrier_name': 'Cielos Airlines', 'carrier_scac_code': 'A2'}, {'carrier_name': 'ABSA Aerolinhas Brasileiras', 'carrier_scac_code': 'M3'}, {'carrier_name': 'Mario’s Air', 'carrier_scac_code': 'M2'}, {'carrier_name': 'Sun Express', 'carrier_scac_code': 'XQ'}, {'carrier_name': 'Ukraine Int´l Airlines', 'carrier_scac_code': 'PS'}, {'carrier_name': 'Air Moldova', 'carrier_scac_code': '9U'}, {'carrier_name': 'Coyne Airways', 'carrier_scac_code': '7C'}, {'carrier_name': 'AirBridge Cargo', 'carrier_scac_code': 'RU'}, {'carrier_name': 'Jet Airways', 'carrier_scac_code': '9W'}, {'carrier_name': 'SriLankan Cargo', 'carrier_scac_code': 'UL'}, {'carrier_name': 'more AWB tracking', 'carrier_scac_code': 'UL'}, {'carrier_name': 'Cameroon Airlines', 'carrier_scac_code': 'UY'}, {'carrier_name': 'ETIHAD Airways', 'carrier_scac_code': 'EY'}, {'carrier_name': 'DHL Aviation / European Air Transport', 'carrier_scac_code': 'QY'}, {'carrier_name': 'Singapore Airlines', 'carrier_scac_code': 'SQ'}, {'carrier_name': 'Bulgaria Air', 'carrier_scac_code': 'FB'}, {'carrier_name': 'Air Greenland', 'carrier_scac_code': 'GL'}, {'carrier_name': 'Yemenia Yemen Airways', 'carrier_scac_code': 'IY'}, {'carrier_name': 'Air Malta', 'carrier_scac_code': 'KM'}, {'carrier_name': 'Air Niugini', 'carrier_scac_code': 'PX'}, {'carrier_name': 'Air Baltic', 'carrier_scac_code': 'BT'}, {'carrier_name': 'Royal Brunei Airlines', 'carrier_scac_code': 'BI'}, {'carrier_name': 'Air Macau', 'carrier_scac_code': 'NX'}, {'carrier_name': 'Eva Airways', 'carrier_scac_code': 'BR'}, {'carrier_name': 'CAL Cargo Air Lines', 'carrier_scac_code': '5C'}, {'carrier_name': 'Kenya Airways', 'carrier_scac_code': 'KQ'}, {'carrier_name': 'MNG Airlines', 'carrier_scac_code': 'MB'}, {'carrier_name': 'Swiss', 'carrier_scac_code': 'LX'}, {'carrier_name': 'Tampa Airlines', 'carrier_scac_code': 'QT'}, {'carrier_name': 'Xiamen Airlines', 'carrier_scac_code': 'MF'}, {'carrier_name': 'SATA Air Acores', 'carrier_scac_code': 'SP'}, {'carrier_name': 'Vietnam Airlines', 'carrier_scac_code': 'VN'}, {'carrier_name': 'Avient', 'carrier_scac_code': 'SM'}, {'carrier_name': 'Azerbaijan Airlines', 'carrier_scac_code': 'J2'}, {'carrier_name': 'Shanghai Airlines', 'carrier_scac_code': 'FM'}, {'carrier_name': 'China Eastern Airlines', 'carrier_scac_code': 'MU'}, {'carrier_name': 'China Southern Airlines', 'carrier_scac_code': 'CZ'}, {'carrier_name': 'Grandstar Cargo', 'carrier_scac_code': 'GD'}, {'carrier_name': 'Mandarin Airlines', 'carrier_scac_code': 'AE'}, {'carrier_name': 'Amerijet International', 'carrier_scac_code': 'M6'}, {'carrier_name': 'SAC South American Airways', 'carrier_scac_code': 'S6'}, {'carrier_name': 'Shanghai Airlines Cargo', 'carrier_scac_code': 'F4'}, {'carrier_name': 'Croatia Airlines', 'carrier_scac_code': 'OU'}, {'carrier_name': 'Hong Kong Airlines', 'carrier_scac_code': 'N8'}, {'carrier_name': 'Africa West', 'carrier_scac_code': 'FK'}, {'carrier_name': 'Atlantic Southeast Airlines', 'carrier_scac_code': 'EV'}, {'carrier_name': 'MASAir', 'carrier_scac_code': 'MY'}, {'carrier_name': 'Aerosvit', 'carrier_scac_code': 'VV'}, {'carrier_name': 'Yangtze River Express Airlines', 'carrier_scac_code': 'Y8'}, {'carrier_name': 'AeroUnion', 'carrier_scac_code': '6R'}, {'carrier_name': 'Sichuan Airlines', 'carrier_scac_code': '3U'}, {'carrier_name': 'Hainan Airlines (Chinese)', 'carrier_scac_code': 'HU'}, {'carrier_name': 'Condor Flugdienst', 'carrier_scac_code': 'DE'}, {'carrier_name': 'Comair', 'carrier_scac_code': 'OH'}, {'carrier_name': 'TAB Cargo', 'carrier_scac_code': 'B1'}, {'carrier_name': 'Air Armenia', 'carrier_scac_code': 'QN'}, {'carrier_name': 'Buraq Air Transport (Arabic only)', 'carrier_scac_code': 'UZ'}, {'carrier_name': 'Virgin Atlantic', 'carrier_scac_code': 'VS'}, {'carrier_name': 'Nippon Cargo Airlines', 'carrier_scac_code': 'KZ'}, {'carrier_name': 'TAM Brazilian Airlines', 'carrier_scac_code': 'JJ'}, {'carrier_name': 'Insel Air Cargo', 'carrier_scac_code': '7I'}, {'carrier_name': 'Estonian Air', 'carrier_scac_code': 'OV'}, {'carrier_name': 'Aeromexpress Cargo', 'carrier_scac_code': 'QO'}, {'carrier_name': 'Asiana Airlines', 'carrier_scac_code': 'OZ'}, {'carrier_name': 'Great Wall Airlines', 'carrier_scac_code': 'IJ'}, {'carrier_name': 'Air Europa Cargo', 'carrier_scac_code': 'UX'}, {'carrier_name': 'Biman Bangladesh', 'carrier_scac_code': 'BG'}, {'carrier_name': 'Air China', 'carrier_scac_code': 'CA'}]


def get_carrier_scac_code(airline_name: str):
    """
    Find the closest matching carrier from mst_carrier for the given airline_name
    and return its SCAC code.
    """

    if not carriers:
        return None

    # Create a dictionary for faster lookup
    carrier_dict = {c["carrier_name"]: c["carrier_scac_code"] for c in carriers}

    # Find best match using fuzzy matching
    best_match = process.extractOne(
        airline_name,
        list(carrier_dict.keys()),
        scorer=fuzz.WRatio
    )

    if best_match and best_match[1] >= 70:  # Minimum 70% similarity
        matched_name = best_match[0]
        return carrier_dict[matched_name]

    return None


matched_name = get_carrier_scac_code(airline_name="Ethiopian Airlines Cargo")
print("matched_name: ", matched_name)



'''
id
4114, 4111, 4059, 4037, 4032, 4023, 4017, 3989, 3988, 3987, 3983, 3982, 3973, 3948, 3942, 3927, 3909, 3908, 3896, 3894, 3883, 3882, 3864, 3863, 3858, 3852, 3840, 3813, 3799, 3777, 3772, 3742, 3736, 3692, 3685, 3684, 3677, 3610, 3604, 3592, 3589, 3511, 3494, 3483, 3481, 3473, 3456, 3455, 3446, 3435, 3416, 3409, 3381, 3347, 3338, 3334, 3333, 3307, 3301, 3295, 3243, 3223, 3222, 

booking_id
4111, 4059, 4032, 4023, 3982, 3927, 3909, 3908, 3896, 3894, 3883, 3882, 3864, 3863, 3858, 3852, 3840, 3813, 3799, 3772, 3742, 3736, 3685, 3684, 3677, 3610, 3604, 3592, 3589, 3347, 3307, 3295, 


'''